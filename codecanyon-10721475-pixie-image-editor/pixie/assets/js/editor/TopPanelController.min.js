"use strict";angular.module("ImageEditor").controller("TopPanelController",["$rootScope","$scope","$mdDialog","$mdToast","$$rAF","canvas","history","saver",function(e,t,i,n,r,o,a,s){t.history=a,t.isDemo=e.isDemo,t.canOpenImage=!1,t.canvas=o,t.openImageMode="open",t.canvasWidth=800,t.canvasHeight=600,t.imageName="image",t.imageType="jpeg",t.imageQuality=8,t.objectsPanelOpen=!0,t.historyPanelOpen=!1,t.openUploadDialog=function(e){i.show({template:$("#main-image-upload-dialog-template").html(),targetEvent:e,controller:"TopPanelController",clickOutsideToClose:!0})},t.toggleRightPanel=function(e,i){var n=t[e+"PanelOpen"];n?(t[e+"PanelOpen"]=!1,$("#"+e).hide()):(t[e+"PanelOpen"]=!0,$("#"+e).show())},t.transformOpen=function(e,i){var n=$("#"+e);n.removeClass("transition-out transition-in").show(),t.transformToClickElement(n,i),r(function(){n.addClass("transition-in").css("transform",""),i.currentTarget.blur()})},t.transformClose=function(i,n){var r=$("#"+i);r.addClass("transition-out").removeClass("transition-in"),t.transformToClickElement(r,n),r.one(e.transitionEndEvent,function(){r.hide().css("transform","").removeClass("transition-out"),n.currentTarget.blur()})},t.transformToClickElement=function(e,t){var i=t.target.getBoundingClientRect(),n=e[0].getBoundingClientRect(),r=Math.min(.5,i.width/n.width),o=Math.min(.5,i.height/n.height);e.css("transform","translate3d("+(-n.left+i.left+i.width/2-n.width/2)+"px,"+(-n.top+i.top+i.height/2-n.height/2)+"px,0) scale("+r+","+o+")")},t.openSaveDialog=function(t){return e.getParam("onSaveButtonClick")?e.getParam("onSaveButtonClick")():e.delayEditorStart?s.saveImage():void i.show({template:$("#save-image-dialog").html(),targetEvent:t,controller:"TopPanelController",clickOutsideToClose:!0})},t.createNewCanvas=function(i,n){o.openNew(i,n),t.closeUploadDialog(),e.started=!0,e.resetUI()},t.openSampleImage=function(){o.loadMainImage("assets/images/lotus.jpg"),t.closeUploadDialog(),e.started=!0},t.saveImage=function(e){s.saveImage(t.imageType,t.imageQuality,t.imageName,e)},t.showImagePreview=function(i){return"data"!==i.substr(0,4)?(t.$apply(function(){t.canOpenImage=!1}),o.fabric.clear(),a.load(JSON.parse(i)),t.closeUploadDialog(),void(e.started=!0)):void fabric.util.loadImage(i,function(e){e?t.$apply(function(){$(".img-preview").html("").append(e),t.canOpenImage=!0}):t.$apply(function(){t.canOpenImage=!1})})},t.openImage=function(){var i=$(".img-preview img").attr("src");i&&t.canOpenImage&&(o.fabric._objects.length&&o.mainImage||e.userPreset?o.openImage(i):(o.fabric.clear(),o.loadMainImage(i)),t.closeUploadDialog(),e.started=!0)},t.closeUploadDialog=function(){t.canUploadImage=!1,t.openImageMode="open",$(".img-preview").html(),i.hide()}}]);
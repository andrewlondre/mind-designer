angular.module("image.basics").controller("ResizeController",["$scope","$rootScope","canvas","history",function(t,e,i,n){function r(t,e){var n=Math.round(i.original.height*e),r=Math.round(i.original.width*t);i.fabric.setHeight(n),i.fabric.setWidth(r),i.original.width=r,i.original.height=n;var o=i.fabric.getObjects();for(var s in o){var a=o[s].scaleX,l=o[s].scaleY,c=o[s].left,u=o[s].top,d=a*t,f=l*e,h=c*t,p=u*e;o[s].scaleX=d,o[s].scaleY=f,o[s].left=h,o[s].top=p,o[s].setCoords()}i.fabric.renderAll()}t.constrainProportions=!0,t.percent=100,t.startResizer=function(e){t.width=t.usePercentages?100:Math.ceil(i.original.width),t.height=t.usePercentages?100:Math.ceil(i.original.height),n.add("beforeResize",!1,!0),i.zoom(1),t.openPanel("resize",e)},t.togglePercentages=function(e){e?(t.width=t.width/i.original.width*100,t.height=t.height/i.original.height*100):(t.width=t.width*i.original.width/100,t.height=t.height*i.original.height/100)},t.apply=function(){var o=Math.ceil(i.original.width),s=Math.ceil(i.original.height),a=Math.ceil(t.width),l=Math.ceil(t.height);if(t.usePercentages)var c=t.width/100,u=t.height/100;else var c=t.width/i.original.width,u=t.height/i.original.height;(o!==a||s!==l)&&(r(c,u),e.activePanel=!1,n.add("resize","open-width"),i.fitToScreen())},t.close=function(){e.activePanel=!1,i.fitToScreen()},t.aspectToHeight=function(e){if(t.constrainProportions)if(t.usePercentages)t.height=e;else{var n=parseFloat((i.original.width/e).toPrecision(3));t.height=Math.ceil(i.original.height/n)}},t.aspectToWidth=function(e){if(t.constrainProportions)if(t.usePercentages)t.width=e;else{var n=parseFloat((i.original.height/e).toPrecision(3));t.width=Math.floor(i.original.width/n)}}}]);
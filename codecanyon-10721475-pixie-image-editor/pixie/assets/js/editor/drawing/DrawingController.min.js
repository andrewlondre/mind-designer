angular.module("image.drawing").controller("DrawingController",["$scope","$rootScope","canvas","drawing","history",function(t,e,i,n,r){t.drawing=n,window.fb=i.fabric,t.changeBrush=function(e,i){t.openPanel("drawing",i),n.isEnabled||n.enable(),n.changeBrush(e)},t.finishAddingDrawingsToCanvas=function(){e.activePanel=!1,i.mainImage&&i.fabric.setActiveObject(i.mainImage),i.fabric.forEachObject(function(t){"freeDrawing"===t.name&&(t.removeOnCancel=!1)}),n.disable(),r.add("added drawing","brush")},t.cancelAddingDrawingsToCanvas=function(){i.fabric.forEachObject(function(t){"freeDrawing"===t.name&&t.removeOnCancel&&i.fabric.remove(t)}),n.disable(),i.fabric.renderAll(),e.activePanel=!1},e.$on("tab.changed",function(e,i){"drawing"!==i&&(n.disable(),t.cancelAddingDrawingsToCanvas())}),i.fabric.on("path:created",function(t){n.isEnabled&&(t.path.setOptions(i.imageStatic),t.path.name="freeDrawing",t.path.removeOnCancel=!0)})}]);
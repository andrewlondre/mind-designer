"use strict";angular.module("ImageEditor").factory("history",["$rootScope","canvas",function(e,t){var i={all:[],ignored:[],add:function(e,i,n){var r=n?"ignored":"all";if("ignored"===r)for(var o=0;o<this.ignored.length;o++)this.ignored[o].name===e&&this.ignored.splice(o,1);this[r].unshift({name:e,state:t.fabric.toJSON(["selectable","name"]),index:this.all.length+1,icon:i,zoom:t.zoom,canvasWidth:t.original.width||t.fabric.getWidth(),canvasHeight:t.original.height||t.fabric.getHeight()})},get:function(e,t){t||(t="ignored");for(var n=0;n<i[t].length;n++)if(i[t][n].name===e)return i[t][n]},getCurrentCanvasState:function(){return{state:t.fabric.toJSON(["selectable","name"]),index:this.all.length+1,zoom:t.zoom,canvasWidth:t.original.width||t.fabric.getWidth(),canvasHeight:t.original.height||t.fabric.getHeight()}},load:function(i){return e.isLoading(),angular.isString(i)&&(i=this.get(i)),i?void setTimeout(function(){t.fabric.loadFromJSON(i.state,function(){t.fabric.forEachObject(function(e){e.applyFilters&&e.filters.length&&e.applyFilters(t.fabric.renderAll.bind(t.fabric)),"mainImage"==e.name&&(t.mainImage=e)}),t.zoom(1),i.canvasWidth&&i.canvasHeight&&(t.fabric.setWidth(i.canvasWidth),t.fabric.setHeight(i.canvasHeight),t.original.width=i.canvasWidth,t.original.height=i.canvasHeight),t.fabric.renderAll(),t.fabric.calcOffset(),e.isNotLoading(),t.fitToScreen(),e.$emit("history.loaded")})},30):e.isNotLoading()}};return i}]);
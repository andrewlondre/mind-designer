angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(e,t,i){return{require:"?ngModel",scope:{ngModel:"=",uiSortable:"="},link:function(n,r,o,a){function l(e,t){return t&&"function"==typeof t?function(){e.apply(this,arguments),t.apply(this,arguments)}:e}function c(e){var t=e.data("ui-sortable");return t&&"object"==typeof t&&"ui-sortable"===t.widgetFullName?t:null}function u(e,t){var i=e.sortable("option","helper");return"clone"===i||"function"==typeof i&&t.item.sortable.isCustomHelperUsed()}function d(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}function f(e,t){for(var i=null,n=0;n<e.length;n++){var r=e[n];if(r.element[0]===t[0]){i=r.scope;break}}return i}function h(e,t){t.item.sortable._destroy()}var s,p={},m={"ui-floating":void 0},g={receive:null,remove:null,start:null,stop:null,update:null},v={helper:null};return angular.extend(p,m,e,n.uiSortable),angular.element.fn&&angular.element.fn.jquery?(a?(n.$watch("ngModel.length",function(){t(function(){c(r)&&r.sortable("refresh")},0,!1)}),g.start=function(e,t){if("auto"===p["ui-floating"]){var i=t.item.siblings(),n=c(angular.element(e.target));n.floating=d(i)}t.item.sortable={model:a.$modelValue[t.item.index()],index:t.item.index(),source:t.item.parent(),sourceModel:a.$modelValue,cancel:function(){t.item.sortable._isCanceled=!0},isCanceled:function(){return t.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!t.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:t.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(t.item.sortable,function(e,i){t.item.sortable[i]=void 0})}}},g.activate=function(e,t){s=r.contents();var i=r.sortable("option","placeholder");if(i&&i.element&&"function"==typeof i.element){var o=i.element();o=angular.element(o);var a=r.find('[class="'+o.attr("class")+'"]:not([ng-repeat], [data-ng-repeat])');s=s.not(a)}var l=t.item.sortable._connectedSortables||[];l.push({element:r,scope:n}),t.item.sortable._connectedSortables=l},g.update=function(e,t){if(!t.item.sortable.received){t.item.sortable.dropindex=t.item.index();var i=t.item.parent();t.item.sortable.droptarget=i;var o=f(t.item.sortable._connectedSortables,i);t.item.sortable.droptargetModel=o.ngModel,r.sortable("cancel")}u(r,t)&&!t.item.sortable.received&&"parent"===r.sortable("option","appendTo")&&(s=s.not(s.last())),s.appendTo(r),t.item.sortable.received&&(s=null),t.item.sortable.received&&!t.item.sortable.isCanceled()&&n.$apply(function(){a.$modelValue.splice(t.item.sortable.dropindex,0,t.item.sortable.moved)})},g.stop=function(e,t){!t.item.sortable.received&&"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()?n.$apply(function(){a.$modelValue.splice(t.item.sortable.dropindex,0,a.$modelValue.splice(t.item.sortable.index,1)[0])}):"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()||u(r,t)||s.appendTo(r),s=null},g.receive=function(e,t){t.item.sortable.received=!0},g.remove=function(e,t){"dropindex"in t.item.sortable||(r.sortable("cancel"),t.item.sortable.cancel()),t.item.sortable.isCanceled()||n.$apply(function(){t.item.sortable.moved=a.$modelValue.splice(t.item.sortable.index,1)[0]})},v.helper=function(e){return e&&"function"==typeof e?function(t,i){var n=e.apply(this,arguments);return i.sortable._isCustomHelperUsed=i!==n,n}:e},n.$watch("uiSortable",function(e){var t=c(r);t&&angular.forEach(e,function(e,i){return i in m?("ui-floating"!==i||e!==!1&&e!==!0||(t.floating=e),void(p[i]=e)):(g[i]?("stop"===i&&(e=l(e,function(){n.$apply()}),e=l(e,h)),e=l(g[i],e)):v[i]&&(e=v[i](e)),p[i]=e,void r.sortable("option",i,e))})},!0),angular.forEach(g,function(e,t){p[t]=l(e,p[t]),"stop"===t&&(p[t]=l(p[t],h))})):i.info("ui.sortable: ngModel not provided!",r),void r.sortable(p)):void i.error("ui.sortable: jQuery should be included before AngularJS!")}}}]);
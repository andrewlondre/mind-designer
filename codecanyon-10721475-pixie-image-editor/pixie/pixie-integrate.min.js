!function(t,e){"use strict";var n,r,o,i=t.document;n=function(){return r.start(),o={save:function(t,e){return r.save(t,e),this},getService:function(t){return r.getService(t)},close:function(){return r.close(),this},open:function(t){return r.open(t),this},enableInteractiveMode:function(t){return r.enableInteractiveMode(t),this},getParams:function(){return r.params},setOptions:function(t){return r.setOptions(t),this}}},r={params:{url:!1,blankCanvasSize:!1,enableCORS:!1,path:"pixie",saveUrl:!1,hideOpenButton:!1,replaceOriginal:!1,forceLaundering:!1,appendTo:"body",noManualClose:!1,openDelay:400,closeDelay:400,onError:function(t){console.log(t)},onLoad:function(){},onSave:function(){},onClose:function(){},onSaveButtonClick:null},errors:{invalidImg:"Image you passed in doesn't exist or can't be loaded"},loaded:!1,cache:{},setOptions:function(t){this.extend(r.params,t)},save:function(t,e){r.loaded&&r.getService("saver").saveImage(t,e)},getService:function(t){return r.injector||(r.injector=r.frameWindow.angular.element(r.frameWindow.document.body).injector()),r.injector.get(t)},start:function(){var e=i.currentScript;if(!e)for(var n=i.getElementsByTagName("script"),o=n.length-1;o>=0;o--)if(n[o].src.indexOf("pixie-integrate.js")>-1){var e=n[o];break}var a=e.dataset;"undefined"!=typeof a.path&&(r.params.path=a.path),a.preload&&!r.loaded&&(t.onload=function(){r.create(),t.onload=null})},enableInteractiveMode:function(t){t=t||{};var e=t.selector||"img",n=i,o=t.preventDefault||!0;t.container&&(n=i.querySelectorAll(t.container)[0]),(n||i).addEventListener("click",function(t){if(t.target.nodeName===e||-1!==t.target.className.indexOf(e.replace(".",""))){o&&t.preventDefault();var i=t.target;"IMG"!==i.nodeName&&(i=t.target.querySelector("img")),i&&"IMG"===i.nodeName&&(r.params.image=i,r.open({url:r.params.image.src}))}})},launderImage:function(t){if(r.params.enableCORS||!r.params.forceLaundering&&r.urlInSameDomain(t))return t;if(r.cache[t])return r.cache[t];var e=r.ajax(r.getPath()+"launderer.php","url="+r.absoluteUrl(t));return e.onload=function(e){e.target.status>=200&&e.target.status<400&&(r.cache[t]=e.target.responseText)},e},close:function(){r.fadeOut(r.container,{duration:r.params.closeDelay,complete:function(){r.container.style.display="none"}}),i.body.classList.remove("noscroll"),this.params.onClose(),r.rootScope.resetUI()},open:function(t){this.loading||(this.extend(r.params,t),i.body.classList.add("noscroll"),this.loaded?r.loadImage():r.create(r.loadImage),r.container.style.display="block",r.loaded&&r.fadeIn(r.container,{duration:r.params.openDelay}))},loadImage:function(){if(r.params.url)r.imageExists(r.params.url,function(t){if(t){var e=r.launderImage(r.params.url);"object"==typeof e?e.onload=function(t){t.target.status>=200&&t.target.status<400&&t.target.responseText&&(r.params.url=t.target.responseText,r.rootScope.canvas.fabric.clear(),r.rootScope.canvas.zoom(1),r.rootScope.canvas.loadMainImage(t.target.responseText),r.rootScope.$apply(function(){r.rootScope.started=!0}))}:"string"==typeof e&&(r.rootScope.canvas.fabric.clear(),r.rootScope.canvas.zoom(1),r.rootScope.canvas.loadMainImage(e),r.rootScope.$apply(function(){r.rootScope.started=!0}))}else r.error("invalidImg",r.params.url)});else if(r.params.blankCanvasSize){var t=r.params.blankCanvasSize;r.rootScope.canvas.openNew(t.width,t.height,"newCanvas"),r.rootScope.$apply(function(){r.rootScope.started=!0,r.rootScope.canvas.zoom(1.1)})}},create:function(t){this.loading=!0;var e='<section id="pixie-editor-container"><div id="pixie-frame-container"><div id="pixie-editor-header">Pixie Editor<div class="pixie-close">&times;</div></div></div></section>',n=i.createElement("link");n.rel="stylesheet",n.href=this.getPath()+"assets/css/integrate.css",i.querySelector("head").appendChild(n);var o=i.createElement("div");o.innerHTML=e,this.container=i.querySelector(r.params.appendTo).appendChild(o.firstChild),this.container.style.display="none",this.frame=i.createElement("iframe"),this.container.querySelector("#pixie-frame-container").appendChild(this.frame),this.frame.onload=function(){r.frameWindow=r.frame.contentWindow,r.rootScope=r.frameWindow.angular.element("body").scope(),r.loaded=!0,r.loading=!1,r.params.onLoad(r.container,r.rootScope,r.frameWindow),t&&t()},this.frame.src=this.getPath()+"index.html",r.params.noManualClose?i.querySelector(".pixie-close").style.display="none":i.addEventListener("click",function(t){("pixie-editor-container"===t.target.id||"pixie-close"===t.target.className)&&r.close()})},imageExists:function(t,e){var i=new Image;i.onload=function(){e(!0)},i.onerror=function(){e(!1)},i.src=t,i=null},urlInSameDomain:function(t){return t.indexOf(i.domain)>-1||-1===t.indexOf("//")||t.indexOf("data:image")>-1},error:function(t,e){r.params.onError({message:r.errors[t],args:e})},getPath:function(){return this.params.path?this.params.path+"/":""},absoluteUrl:function(t){if(t.indexOf("//")>-1)return t;var e=i.createElement("a");return e.href=t,e.href},extend:function(t){t=t||{};for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}return t},ajax:function(t,e){var i=new XMLHttpRequest;return i.open("POST",t,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(e),i},animate:function(t){var e=new Date,i=setInterval(function(){var n=new Date-e,r=n/t.duration;r>1&&(r=1),t.progress=r;var o=t.delta(r);t.step(o),1==r&&(clearInterval(i),t.complete&&t.complete())},t.delay||10)},fadeOut:function(t,e){var i=1;r.animate({duration:e.duration,delta:function(t){return.5-Math.cos(t*Math.PI)/2},complete:e.complete,step:function(e){t.style.opacity=i-e}})},fadeIn:function(t,e){var i=0;r.animate({duration:e.duration,delta:function(t){return.5-Math.cos(t*Math.PI)/2},complete:e.complete,step:function(e){t.style.opacity=i+e}})}},t.Pixie=new n}(this);
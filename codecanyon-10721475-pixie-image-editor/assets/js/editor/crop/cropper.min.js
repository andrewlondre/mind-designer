angular.module("image.crop",[]).service("cropper",["$rootScope","cropzone","canvas","history",function(t,e,i,n){var r={start:function(i){e.initiated||(e.add(),t.openPanel("crop",i))},stop:function(i){e.remove(),t.activePanel=!1},crop:function(){if(!e.initiated)return!1;e.hide();var r=new Image;r.onload=function(){var r=new fabric.Image(this,i.imageStatic);r.name="mainImage",i.mainImage&&i.mainImage.remove(),i.fabric.clear(),i.fabric.setWidth(Math.ceil(e.rect.getWidth())),i.fabric.setHeight(Math.ceil(e.rect.getHeight())),i.fabric.add(r),r.moveTo(0),r.center(),i.mainImage=r,e.remove(),n.add("crop","crop"),t.$apply(function(){t.activePanel=!1})},i.zoom(1),t.editorCustomActions.crop={left:e.rect.getLeft(),top:e.rect.getTop(),width:Math.ceil(e.rect.getWidth()),height:Math.ceil(e.rect.getHeight())},r.src=i.fabric.toDataURL({left:e.rect.getLeft(),top:e.rect.getTop(),width:Math.ceil(e.rect.getWidth()),height:Math.ceil(e.rect.getHeight())}),i.original.width=Math.ceil(e.rect.getWidth()),i.original.height=Math.ceil(e.rect.getHeight())}};return r}]);
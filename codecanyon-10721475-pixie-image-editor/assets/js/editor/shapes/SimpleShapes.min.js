angular.module("image.shapes").filter("orderOptions",function(){return function(t,e,i){var n=[];return angular.forEach(t,function(t,e){t.name=e,n.push(t)}),n.sort(function(t,i){return t[e]>i[e]?1:-1}),i&&n.reverse(),n}}).service("simpleShapes",["$rootScope","canvas","polygon","history",function(t,e,i,n){var r={gradients:edGradients,textures:new Array(28),baseOptions:{main:{enabled:!0,opacity:{type:"slider",current:1,min:.1,max:1,step:.1},fill:{type:"colorpicker",current:"#263238",hidden:!0}},border:{enabled:!1,onToggle:"toggleBorder",stroke:{type:"colorpicker",current:"#2196F3",displayName:"Color"},strokeWidth:{type:"slider",current:5,max:40,displayName:"Width"}},shadow:{enabled:!1,onToggle:"toggleShadow",color:{type:"colorpicker",current:"rgba(0,0,0,0.5)"},blur:{type:"slider",current:5,max:80},offsetX:{type:"slider",current:8,max:30},offsetY:{type:"slider",current:5,max:30}}},available:[],selected:!1,fillWithGradient:function(t,i){var n=e.fabric.getActiveObject();n.setGradient(i||"fill",this.gradients[t]),e.fabric.renderAll()},fillWithImage:function(t){var i=e.fabric.getActiveObject();fabric.util.loadImage(t,function(t){i.setPatternFill({source:t}),e.fabric.renderAll()})},addToCanvas:function(t){if(this.shapeExists(t)){if(this.selected=t,t.service&&t.service.enable)return t.service.enable();var i=this.createNewShape(t);e.fabric.add(i),e.center(i),e.fabric.setActiveObject(i),e.fabric.renderAll(),n.add("Added: "+t.name,"panorama-vertical")}},applyValue:function(t,i,n,r){var o="set"+fabric.util.string.capitalize(n,!0),s=this.getShape(i);return"shadow"===t?this.applyShadowValue(s,n,r):void(this.selected&&this.selected.name===i&&(s[o]?s[o](r):s[n]=r,s.setCoords(),e.fabric.setActiveObject(s),e.fabric.renderAll()))},applyShadowValue:function(t,i,n){if(t){var r={color:this.selected.options.shadow.color.current,blur:this.selected.options.shadow.blur.current,offsetX:this.selected.options.shadow.offsetX.current,offsetY:this.selected.options.shadow.offsetY.current};i&&n&&(r[i]=n),t.setShadow(r),e.fabric.renderAll()}},toggleShadow:function(t,i){i?this.applyShadowValue(this.getShape(t)):(this.getShape(t).setShadow(!1),e.fabric.renderAll())},toggleBorder:function(t,i){i?this.getShape(t).setStroke(this.selected.options.border.stroke):this.getShape(t).setStroke(!1),e.fabric.renderAll()},shapeExists:function(t){for(var e=0;e<this.available.length;e++)if(this.available[e].name===t.name)return!0},getShape:function(t){var i=e.fabric.getActiveObject();return i&&i.name===t?i:(e.fabric.forEachObject(function(n){return n.name===t?(e.fabric.setActiveObject(n),i=n):void 0}),i)},createNewShape:function(t){var e=fabric.util.string.capitalize(t.name,!0);if(fabric[e]){var i={strokeWidth:t.options.border.strokeWidth.current};if(angular.forEach(t.options.main,function(t,e){"boolean"!=typeof t&&(i[e]=t.current)}),t.options.points)var n=new fabric[e](t.options.points.current,i);else var n=new fabric[e](i);return n.name=t.name,n}},selectShape:function(t){if(t&&this.selected.name!==t)for(var e=0;e<this.available.length;e++)if(this.available[e].name===t)return this.selected=this.available[e]}},o=angular.copy(r.baseOptions);o.main.radius={type:"slider",current:72,min:20},r.available.push({name:"circle",options:o});var s=angular.copy(r.baseOptions);s.main.width={type:"slider",current:140},s.main.height={type:"slider",current:140},r.available.push({name:"rect",displayName:"rectangle",options:s});var a=angular.copy(r.baseOptions);a.main.width={type:"slider",current:140,min:25},a.main.height={type:"slider",current:140,min:25},r.available.push({name:"triangle",options:a});var l=angular.copy(r.baseOptions);return l.main.rx={type:"slider",current:80,displayName:"horizontal radius"},l.main.ry={type:"slider",current:30,displayName:"vertical radius"},r.available.push({name:"ellipse",options:l}),r.available.push({name:"polygon",options:angular.copy(r.baseOptions),service:i}),r}]);
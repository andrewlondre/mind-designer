angular.module("image.basics").controller("RoundedCornersController",["$scope","$rootScope","canvas","history",function(t,e,i,n){t.radius=50,t.startRoundedCorners=function(n){"round"!==e.activePanel&&(e.openPanel("round",n),t.rect=new fabric.Rect({width:i.original.width,height:i.original.height,rx:t.radius,ry:t.radius,opacity:1,fill:"transparent",name:"rounding-rect",stroke:"#fff",strokeDashArray:[5,5],selectable:!1,evented:!1,ignore:!0}),i.fabric.add(t.rect),i.fabric.renderAll())},t.adjustPreview=function(){t.rect&&(t.rect.set({rx:t.radius,ry:t.radius}),i.fabric.renderAll())},t.cancel=function(n){i.fabric.remove(t.rect),t.rect=!1,t.radius=50,i.fabric.renderAll(),n||(e.activePanel=!1)},t.apply=function(){e.editorCustomActions.roundCorners=angular.copy(t.radius),i.fabric.remove(t.rect),i.zoom(1),i.fabric.clipTo=function(e){t.rect.render(e),i.fabric.clipTo=!1};var r=i.fabric.toDataURL();i.fabric.clear(),t.cancel(),i.loadMainImage(r,!1,!1,!1,function(){e.$apply(function(){n.add("Round Corners","panorama-wide-angle")})})},e.$on("tab.changed",function(e,i,n){"basics"===n&&t.rect&&"basics"!==i&&t.cancel()}),e.$watch("activePanel",function(e,i){"round"!==e&&"round"===i&&t.cancel(!0)})}]);
angular.module("image.basics",[]).controller("RotateController",["$scope","$rootScope","canvas","history",function(t,e,i,n){t.angle=0,t.startRotator=function(e){n.add("rotate-original-state","backup",!0),t.openPanel("rotate",e)},t.applyRotation=function(){e.activePanel=!1,n.add("rotation","rotate-right")},t.cancel=function(){n.load("rotate-original-state"),e.activePanel=!1,t.angle=0},t.rotateProper=function(t){i.zoom(1);var n=(i.mainImage.getAngle()+t)%360,r=Math.abs(i.mainImage.getWidth()*Math.sin(n*Math.PI/180))+Math.abs(i.mainImage.getHeight()*Math.cos(n*Math.PI/180)),o=Math.abs(i.mainImage.getHeight()*Math.sin(n*Math.PI/180))+Math.abs(i.mainImage.getWidth()*Math.cos(n*Math.PI/180));i.fabric.setWidth(o*i.currentZoom),i.fabric.setHeight(r*i.currentZoom),i.original.height=r,i.original.width=o,i.mainImage.center(),i.fabric.forEachObject(function(e){e.rotate((e.getAngle()+t)%360),e.setCoords()}),e.editorCustomActions.rotate=t,i.fabric.renderAll(),i.fitToScreen()},t.rotate=function(e,n){if(!(!e||e>360||0>e)){var r=!1;i.fabric.forEachObject(function(i){n&&"left"===n?e=i.getAngle()-90:n&&"right"===n&&(e=i.getAngle()+90),"center"===i.originX&&"center"===i.originY||!i.centeredRotation||(t.setOriginToCenter&&t.setOriginToCenter(i),r=!0),e=e>360?90:0>e?270:e,i.setAngle(e).setCoords(),r&&t.setCenterToOrigin&&t.setCenterToOrigin(i)}),i.fitToScreen(),i.fabric.renderAll()}},t.setOriginToCenter=function(t){t._originalOriginX=t.originX,t._originalOriginY=t.originY;var e=t.getCenterPoint();t.set({originX:"center",originY:"center",left:e.x,top:e.y})},t.setCenterToOrigin=function(t){var e=t.translateToOriginPoint(t.getCenterPoint(),t._originalOriginX,t._originalOriginY);t.set({originX:t._originalOriginX,originY:t._originalOriginY,left:e.x,top:e.y})}}]);
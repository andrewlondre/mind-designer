"use strict";angular.module("ImageEditor").factory("saver",["$rootScope","$mdDialog","$http","$timeout","canvas","cropper","history",function(e,t,i,n,r,o,a){var s={saveImage:function(t,i,n,a){return r.fabric.deactivateAll(),o.stop(),e.isDemo?this.handleDemoSiteSave(a):e.isIntegrationMode?this.handleIntegrationModeSave(t,i,n):void this.saveToComputer(t,i,n)},handleIntegrationModeSave:function(i,n,o){r.zoom(1);var a=this.getDataUrl(i,n);this.handleCallbacks(a,o),$(".md-dialog-container").remove(),t.hide(),e.pixie.close()},saveToComputer:function(e,i,n){r.zoom(1);var o=document.createElement("a"),a=this.getDataUrl(e,i);this.handleCallbacks(a,n),"undefined"!=typeof o.download?(o.download=(n||"image")+"."+e,o.href=a,document.body.appendChild(o),o.click(),document.body.removeChild(o)):r.fabric.lowerCanvasEl.toBlob(function(t){saveAs(t,n+"."+e)},"image/"+e,i),t.hide()},handleCallbacks:function(t,n){if(e.getParam("replaceOriginal")&&e.getParam("image")&&(e.getParam("image").src=t),e.getParam("saveUrl")&&i.post(e.getParam("saveUrl"),{data:t,name:n}),e.getParam("onSave")){var r=e.getParam("image")||new Image(t);e.getParam("onSave")(t,r,n)}},handleDemoSiteSave:function(t){$(".demo-alert").one(e.animationEndEvent,function(){$(this).removeClass("animated shake"),t.target.blur()}).addClass("animated shake")},getDataUrl:function(e,t){return"json"===e?"data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a.getCurrentCanvasState())):r.fabric.toDataURL({format:e||"png",quality:(t||8)/10})}};return s}]);
angular.module("image.drawing",[]).service("drawing",["$rootScope","canvas",function(t,e){var i={availableBrushes:["pencil","vLine","diamond","hLine","circle","square","spray"],defaultBrushName:"pencil",activeBrushName:!1,isEnabled:!1,params:{shadowColor:"#1E89E6",brushWidth:9,brushColor:"#000",shadowBlur:30,shadowOffsetX:10,shadowOffsetY:10,enableShadow:!1},enable:function(){e.fabric.isDrawingMode=!0,this.changeBrush(this.defaultBrushName),this.shadow||(this.shadow=new fabric.Shadow({color:this.params.shadowColor,blur:this.params.shadowBlur,offsetX:this.params.shadowOffsetX,offsetY:this.params.shadowOffsetY})),this.isEnabled=!0},disable:function(){e.fabric.isDrawingMode=!1,this.isEnabled=!1},setShadowProperty:function(t,i){e.fabric.freeDrawingBrush.shadow[t]&&(e.fabric.freeDrawingBrush.shadow[t]=i)},setProperty:function(t,i){e.fabric.freeDrawingBrush[t]&&(e.fabric.freeDrawingBrush[t]=i)},toggleShadow:function(t){t?e.fabric.freeDrawingBrush.shadow=this.shadow:(this.shadow=e.fabric.freeDrawingBrush.shadow,e.fabric.freeDrawingBrush.shadow=void 0)},changeBrush:function(t){this.activeBrushName=t,t=this.makeBrushName(t),fabric[t]?e.fabric.freeDrawingBrush=new fabric[t](e.fabric):this[t]?e.fabric.freeDrawingBrush=this[t]:this["make"+t]&&(e.fabric.freeDrawingBrush=this["make"+t]()),e.fabric.freeDrawingBrush.width=this.params.brushWidth,e.fabric.freeDrawingBrush.color=this.params.brushColor,this.params.enableShadow&&(e.fabric.freeDrawingBrush.shadow=this.shadow)},makeBrushName:function(t){return t.charAt(0).toUpperCase()+t.slice(1)+"Brush"},makeVLineBrush:function(){return this.VLineBrush=new fabric.PatternBrush(e.fabric),this.VLineBrush.getPatternSrc=function(){var t=fabric.document.createElement("canvas");t.width=t.height=10;var e=t.getContext("2d");return e.strokeStyle=this.color,e.lineWidth=5,e.beginPath(),e.moveTo(0,5),e.lineTo(10,5),e.closePath(),e.stroke(),t},this.VLineBrush},makeDiamondBrush:function(){return this.DiamondBrush=new fabric.PatternBrush(e.fabric),this.DiamondBrush.getPatternSrc=function(){var t=10,e=5,i=fabric.document.createElement("canvas"),n=new fabric.Rect({width:t,height:t,angle:45,fill:this.color}),r=n.getBoundingRectWidth();i.width=i.height=r+e,n.set({left:r/2,top:r/2});var o=i.getContext("2d");return n.render(o),i},this.DiamondBrush},makeHLineBrush:function(){return this.HLineBrush=new fabric.PatternBrush(e.fabric),this.HLineBrush.getPatternSrc=function(){var t=fabric.document.createElement("canvas");t.width=t.height=10;var e=t.getContext("2d");return e.strokeStyle=this.color,e.lineWidth=5,e.beginPath(),e.moveTo(5,0),e.lineTo(5,10),e.closePath(),e.stroke(),t},this.HLineBrush},makeSquareBrush:function(){return this.SquareBrush=new fabric.PatternBrush(e.fabric),this.SquareBrush.getPatternSrc=function(){var t=10,e=2,i=fabric.document.createElement("canvas");i.width=i.height=t+e;var n=i.getContext("2d");return n.fillStyle=this.color,n.fillRect(0,0,t,t),i},this.SquareBrush}};return i}]);